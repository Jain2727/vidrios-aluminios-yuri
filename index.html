<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Profesional de Cotizaciones - Yuri</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
    font-family:'Montserrat',sans-serif;
    background:#eef3f9;
    margin:0;
    padding:20px;
    color:#1b2b48;
}
h1{
    font-family:'Playfair Display',serif;
    font-size:30px;
    letter-spacing:2px;
    margin-bottom:25px;
}
.panel{
    background:white;
    padding:25px;
    border-radius:12px;
    box-shadow:0 8px 25px rgba(0,0,0,0.08);
    margin-bottom:30px;
}
input,textarea{
    width:100%;
    padding:8px;
    border-radius:8px;
    border:1px solid #ccd6e0;
    margin-bottom:10px;
}
button{
    background:#0d47a1;
    color:white;
    padding:8px 16px;
    border:none;
    border-radius:8px;
    margin:5px 5px 5px 0;
    cursor:pointer;
    font-weight:600;
}
button:hover{background:#08306b;}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
th{
    background:#0d47a1;
    color:white;
    padding:10px;
}
td{
    border:1px solid #dbe3ef;
    padding:8px;
}
.a4{
    width:210mm;
    min-height:297mm;
    background:white;
    padding:40px;
    margin:auto;
    box-shadow:0 10px 30px rgba(0,0,0,0.15);
    position:relative;
}
.header{
    display:flex;
    justify-content:space-between;
    margin-bottom:25px;
}
.footer{
    position:absolute;
    bottom:0;
    left:0;
    width:100%;
    background:#0d47a1;
    color:white;
    padding:12px 40px;
    font-size:13px;
}
.totales{
    width:300px;
    margin-left:auto;
    margin-top:15px;
}
.firma{
    margin-top:40px;
}
.firma img{height:80px;}
</style>
</head>

<body>

<h1>VIDRIOS Y ALUMINIOS YURI</h1>

<div class="panel" id="dashboard">
<h3>Historial de Cotizaciones</h3>
<input id="buscar" placeholder="Buscar por cliente..." onkeyup="filtrar()">
<table>
<thead>
<tr>
<th>N°</th>
<th>Cliente</th>
<th>Fecha</th>
<th>Total</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="historial"></tbody>
</table>
<button onclick="nueva()">Crear Nueva Cotización</button>
</div>

<div class="panel" id="formPanel" style="display:none;">
<h3>Crear / Editar Cotización</h3>

<label>N° Cotización</label>
<input id="numero" disabled>

<label>Fecha</label>
<input id="fecha" disabled>

<h4>Datos Cliente</h4>
<input id="nombre" placeholder="Nombre">
<input id="ruc" placeholder="DNI / RUC">
<input id="telefono" placeholder="Teléfono">
<input id="direccion" placeholder="Dirección">

<h4>Agregar Servicio</h4>
<input id="descripcion" placeholder="Descripción">
<input id="medidas" placeholder="Medidas (alto x ancho)">
<input id="cantidad" type="number" value="1">
<input id="precio" type="number" value="0">
<button onclick="agregarItem()">Agregar Ítem</button>

<table>
<thead>
<tr>
<th>Item</th>
<th>Descripción</th>
<th>Medidas</th>
<th>Cant.</th>
<th>Precio</th>
<th>Subtotal</th>
<th>X</th>
</tr>
</thead>
<tbody id="tablaItems"></tbody>
</table>

<div class="totales">
<p>Subtotal: S/ <span id="sub">0.00</span></p>
<p>IGV 18%: S/ <span id="igv">0.00</span></p>
<h3>Total: S/ <span id="total">0.00</span></h3>
</div>

<button onclick="guardar()">Guardar</button>
<button onclick="verVista()">Vista Profesional</button>
<button onclick="descargarPDF()">Descargar PDF</button>
<button onclick="exportarImagen()">Exportar Imagen</button>
<button onclick="enviarWhatsApp()">WhatsApp</button>
<button onclick="cancelar()">Cancelar</button>
</div>

<div id="vista" style="display:none;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>

let cotizaciones=JSON.parse(localStorage.getItem("cotizaciones"))||[];
let items=[];
let editando=null;

function nueva(){
    document.getElementById("dashboard").style.display="none";
    document.getElementById("formPanel").style.display="block";
    items=[];
    renderItems();
    let numero="2026-"+(cotizaciones.length+1).toString().padStart(4,"0");
    document.getElementById("numero").value=numero;
    document.getElementById("fecha").value=new Date().toLocaleDateString();
}

function cancelar(){
    document.getElementById("dashboard").style.display="block";
    document.getElementById("formPanel").style.display="none";
}

function agregarItem(){
    let desc=descripcion.value;
    let med=medidas.value;
    let cant=parseFloat(cantidad.value);
    let precio=parseFloat(precio.value);
    let subtotal=cant*precio;
    items.push({desc,med,cant,precio,subtotal});
    renderItems();
}

function renderItems(){
    let tbody=document.getElementById("tablaItems");
    tbody.innerHTML="";
    items.forEach((i,index)=>{
        tbody.innerHTML+=`
        <tr>
        <td>${index+1}</td>
        <td>${i.desc}</td>
        <td>${i.med}</td>
        <td>${i.cant}</td>
        <td>S/ ${i.precio.toFixed(2)}</td>
        <td>S/ ${i.subtotal.toFixed(2)}</td>
        <td><button onclick="eliminarItem(${index})">X</button></td>
        </tr>`;
    });
    calcular();
}

function eliminarItem(i){
    items.splice(i,1);
    renderItems();
}

function calcular(){
    let subtotal=items.reduce((a,b)=>a+b.subtotal,0);
    let igv=subtotal*0.18;
    let total=subtotal+igv;
    sub.innerText=subtotal.toFixed(2);
    igv.innerText=igv.toFixed(2);
    total.innerText=total.toFixed(2);
}

function guardar(){
    let data={
        numero:numero.value,
        fecha:fecha.value,
        nombre:nombre.value,
        ruc:ruc.value,
        telefono:telefono.value,
        direccion:direccion.value,
        items:items,
        total:parseFloat(total.innerText)
    };
    cotizaciones.push(data);
    localStorage.setItem("cotizaciones",JSON.stringify(cotizaciones));
    alert("Guardado correctamente");
    location.reload();
}

function cargarHistorial(){
    let tbody=document.getElementById("historial");
    cotizaciones.forEach((c,index)=>{
        tbody.innerHTML+=`
        <tr>
        <td>${c.numero}</td>
        <td>${c.nombre}</td>
        <td>${c.fecha}</td>
        <td>S/ ${c.total.toFixed(2)}</td>
        <td>
        <button onclick="editar(${index})">Editar</button>
        <button onclick="eliminar(${index})">Eliminar</button>
        </td>
        </tr>`;
    });
}

function editar(i){
    let c=cotizaciones[i];
    nueva();
    numero.value=c.numero;
    fecha.value=c.fecha;
    nombre.value=c.nombre;
    ruc.value=c.ruc;
    telefono.value=c.telefono;
    direccion.value=c.direccion;
    items=c.items;
    renderItems();
}

function eliminar(i){
    cotizaciones.splice(i,1);
    localStorage.setItem("cotizaciones",JSON.stringify(cotizaciones));
    location.reload();
}

function filtrar(){
    let texto=buscar.value.toLowerCase();
    historial.innerHTML="";
    cotizaciones.filter(c=>c.nombre.toLowerCase().includes(texto))
    .forEach((c,index)=>{
        historial.innerHTML+=`
        <tr>
        <td>${c.numero}</td>
        <td>${c.nombre}</td>
        <td>${c.fecha}</td>
        <td>S/ ${c.total.toFixed(2)}</td>
        </tr>`;
    });
}

function verVista(){
    let subtotal=items.reduce((a,b)=>a+b.subtotal,0);
    let igv=subtotal*0.18;
    let total=subtotal+igv;

    vista.innerHTML=`
    <div class="a4">
    <div class="header">
    <div>
    <img src="logo.png" height="70"><br>
    <strong>VIDRIOS Y ALUMINIOS YURI</strong><br>
    RUC: 10617365036<br>
    CC.HACCA S/N OMACHA - PARURO - CUSCO
    </div>
    <div style="text-align:right">
    <h2>COTIZACIÓN</h2>
    ${fecha.value}
    </div>
    </div>

    <strong>Cliente:</strong> ${nombre.value}<br>
    <strong>DNI/RUC:</strong> ${ruc.value}<br>
    <strong>Teléfono:</strong> ${telefono.value}<br>
    <strong>Dirección:</strong> ${direccion.value}

    <table>
    <thead>
    <tr>
    <th>Item</th>
    <th>Descripción</th>
    <th>Medidas</th>
    <th>Cant.</th>
    <th>Precio</th>
    <th>Subtotal</th>
    </tr>
    </thead>
    <tbody>
    ${items.map((i,index)=>`
    <tr>
    <td>${index+1}</td>
    <td>${i.desc}</td>
    <td>${i.med}</td>
    <td>${i.cant}</td>
    <td>S/ ${i.precio.toFixed(2)}</td>
    <td>S/ ${i.subtotal.toFixed(2)}</td>
    </tr>`).join("")}
    </tbody>
    </table>

    <div class="totales">
    <p>Subtotal: S/ ${subtotal.toFixed(2)}</p>
    <p>IGV 18%: S/ ${igv.toFixed(2)}</p>
    <h3>Total: S/ ${total.toFixed(2)}</h3>
    </div>

    <div class="firma">
    <p>Firma:</p>
    <img src="firma.png">
    </div>

    <p><strong>Términos:</strong> Cotización válida por 7 días. No incluye transporte salvo acuerdo previo.</p>

    <div class="footer">
    CC.HACCA S/N OMACHA - PARURO - CUSCO |
    Correo: hermozayurihermozapuelles@gmail.com |
    Cel: 993 963 381
    </div>
    </div>`;
    vista.style.display="block";
}

async function descargarPDF(){
    verVista();
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("p","mm","a4");
    const canvas = await html2canvas(document.querySelector(".a4"),{scale:2});
    const imgData = canvas.toDataURL("image/png");
    doc.addImage(imgData,"PNG",0,0,210,297);
    doc.save("Cotizacion_Yuri.pdf");
}

function exportarImagen(){
    html2canvas(document.querySelector(".a4")).then(canvas=>{
        let link=document.createElement("a");
        link.download="Cotizacion.png";
        link.href=canvas.toDataURL();
        link.click();
    });
}

function enviarWhatsApp(){
    let mensaje=`Hola ${nombre.value}, te envío la cotización ${numero.value}. Total: S/ ${total.innerText}`;
    window.open("https://wa.me/?text="+encodeURIComponent(mensaje));
}

cargarHistorial();

</script>

</body>
</html>
