<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VIDRIOS Y ALUMINIOS YURI</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<style>
body{font-family:Arial;background:#f2f4f8;padding:20px;}
.container{max-width:1000px;margin:auto;background:white;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
h1{text-align:center;}
input,select{padding:8px;margin:5px;width:180px;}
button{padding:10px 15px;margin:5px;background:#0d6efd;color:white;border:none;border-radius:5px;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
.total-box{text-align:right;margin-top:20px;font-size:18px;}
</style>
</head>
<body>

<div class="container">

<h1>VIDRIOS Y ALUMINIOS YURI</h1>

<h3>Datos del Cliente</h3>
<input type="text" id="cliente" placeholder="Nombre cliente">
<input type="text" id="ruc" placeholder="DNI / RUC">
<input type="text" id="telefono" placeholder="Tel茅fono">
<input type="text" id="direccion" placeholder="Direcci贸n">

<h3>Agregar Servicio</h3>

<select id="tipo">
<option value="libre">Servicio Libre</option>
<option value="m2">Por Metro Cuadrado</option>
<option value="unidad">Por Unidad</option>
</select>

<input type="text" id="descripcion" placeholder="Descripci贸n">
<input type="number" id="alto" placeholder="Alto (m)">
<input type="number" id="ancho" placeholder="Ancho (m)">
<input type="number" id="cantidad" placeholder="Cantidad">
<input type="number" id="precio" placeholder="Precio">

<button onclick="agregar()">Agregar</button>

<table id="tabla">
<tr>
<th>Descripci贸n</th>
<th>Cantidad</th>
<th>Precio</th>
<th>Subtotal</th>
</tr>
</table>

<div class="total-box">
<p>Subtotal: S/ <span id="subtotal">0</span></p>
<p>IGV (18%): S/ <span id="igv">0</span></p>
<p><strong>Total: S/ <span id="total">0</span></strong></p>

<p>
Adelanto (%):
<input type="number" id="adelantoPorcentaje" value="40" style="width:60px" oninput="calcular()">
</p>

<p>Adelanto: S/ <span id="adelantoMonto">0</span></p>
<p>Saldo: S/ <span id="saldo">0</span></p>

<button onclick="guardarCotizacion()">Guardar Cotizaci贸n</button>

</div>

</div>

<script>

//  CONFIGURACIN FIREBASE (TU PROYECTO)
const firebaseConfig = {
  apiKey: "AIzaSyDvyVnL6c50raTdwWwyX536e7ekBpVU_TM",
  authDomain: "vidrios-aluminios-yuri-78c46.firebaseapp.com",
  projectId: "vidrios-aluminios-yuri-78c46",
  storageBucket: "vidrios-aluminios-yuri-78c46.firebasestorage.app",
  messagingSenderId: "924651472923",
  appId: "1:924651472923:web:b411161733f72a927d10be"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let totalGeneral = 0;
let items = [];

function agregar(){
    let tipo = document.getElementById("tipo").value;
    let descripcion = document.getElementById("descripcion").value;
    let alto = parseFloat(document.getElementById("alto").value)||0;
    let ancho = parseFloat(document.getElementById("ancho").value)||0;
    let cantidad = parseFloat(document.getElementById("cantidad").value)||1;
    let precio = parseFloat(document.getElementById("precio").value)||0;

    let subtotal = 0;

    if(tipo==="m2"){
        let m2 = alto * ancho;
        subtotal = m2 * precio;
    }else{
        subtotal = cantidad * precio;
    }

    totalGeneral += subtotal;

    items.push({descripcion, cantidad, precio, subtotal});

    let tabla = document.getElementById("tabla");
    let fila = tabla.insertRow();
    fila.insertCell(0).innerHTML = descripcion;
    fila.insertCell(1).innerHTML = cantidad;
    fila.insertCell(2).innerHTML = precio;
    fila.insertCell(3).innerHTML = subtotal.toFixed(2);

    calcular();
}

function calcular(){
    let igv = totalGeneral * 0.18;
    let total = totalGeneral + igv;

    let porcentaje = parseFloat(document.getElementById("adelantoPorcentaje").value)||0;
    let adelantoMonto = total * (porcentaje/100);
    let saldo = total - adelantoMonto;

    document.getElementById("subtotal").innerText = totalGeneral.toFixed(2);
    document.getElementById("igv").innerText = igv.toFixed(2);
    document.getElementById("total").innerText = total.toFixed(2);
    document.getElementById("adelantoMonto").innerText = adelantoMonto.toFixed(2);
    document.getElementById("saldo").innerText = saldo.toFixed(2);
}

function guardarCotizacion(){

    let cliente = document.getElementById("cliente").value;
    let ruc = document.getElementById("ruc").value;
    let telefono = document.getElementById("telefono").value;
    let direccion = document.getElementById("direccion").value;

    let igv = totalGeneral * 0.18;
    let total = totalGeneral + igv;
    let porcentaje = parseFloat(document.getElementById("adelantoPorcentaje").value)||0;
    let adelantoMonto = total * (porcentaje/100);
    let saldo = total - adelantoMonto;

    db.collection("cotizaciones").add({
        cliente,
        ruc,
        telefono,
        direccion,
        items,
        subtotal: totalGeneral,
        igv,
        total,
        adelantoPorcentaje: porcentaje,
        adelantoMonto,
        saldo,
        fecha: new Date()
    }).then(()=>{
        alert("Cotizaci贸n guardada correctamente");
        location.reload();
    });

}

</script>

</body>
</html>
