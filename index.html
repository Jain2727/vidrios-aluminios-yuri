<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vidrios y Aluminios Yuri - Sistema Profesional</title>

<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body{
  font-family:'Inter',sans-serif;
  background:#f2f5fa;
  margin:25px;
  color:#003366;
}
h1{
  font-family:'Merriweather',serif;
  font-size:30px;
  border-bottom:3px solid #0059b3;
  padding-bottom:10px;
}
.panel{
  background:white;
  padding:25px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
  margin-bottom:40px;
}
input,textarea{
  width:100%;
  padding:8px;
  margin-bottom:10px;
  border-radius:8px;
  border:1.5px solid #0073e6;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:8px;
  background:#0059b3;
  color:white;
  cursor:pointer;
  margin-right:6px;
}
button.danger{background:#cc0000;}
button.gray{background:#6c757d;}
.flex{display:flex;gap:10px;flex-wrap:wrap;}
.flex>div{flex:1;}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th{
  background:#0059b3;
  color:white;
  padding:8px;
}
td{
  border:1px solid #ccc;
  padding:6px;
}
.total-box{
  background:#eef5ff;
  padding:15px;
  border-radius:10px;
  text-align:right;
  font-weight:600;
}
iframe{
  width:100%;
  height:600px;
  border:1px solid #ccc;
  margin-top:20px;
}
.logo-preview,.firma-preview{max-height:80px;margin-top:10px;}
</style>
</head>

<body>

<h1>VIDRIOS Y ALUMINIOS YURI</h1>

<div class="panel">
<h3>Configuración Empresa</h3>
<label>Subir Logo PNG</label>
<input type="file" id="logoInput" accept="image/png">
<img id="logoPreview" class="logo-preview">

<label>Subir Firma PNG</label>
<input type="file" id="firmaInput" accept="image/png">
<img id="firmaPreview" class="firma-preview">
</div>

<div class="panel">
<h2>Historial</h2>
<input type="text" id="buscar" placeholder="Buscar por cliente / DNI / RUC">
<table>
<thead>
<tr>
<th>N°</th>
<th>Cliente</th>
<th>DNI/RUC</th>
<th>Fecha</th>
<th>Total</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="historial"></tbody>
</table>
<br>
<button onclick="nueva()">+ Nueva Cotización</button>
</div>

<div class="panel" id="formulario" style="display:none;">

<h2>Cotización</h2>

<div class="flex">
<div><label>N°</label><input id="numero"></div>
<div><label>Fecha Emisión</label><input type="date" id="fecha"></div>
<div><label>Validez</label><input type="date" id="validez"></div>
</div>

<h3>Cliente</h3>
<input id="cliente" placeholder="Nombre">
<input id="doc" placeholder="DNI / RUC">
<input id="telefono" placeholder="Teléfono">
<textarea id="direccion" placeholder="Dirección"></textarea>

<h3>Ítems</h3>
<div class="flex">
<input id="codigo" placeholder="Código">
<input id="descripcion" placeholder="Descripción">
<input id="medidas" placeholder="Medidas">
<input id="cantidad" type="number" value="1">
<input id="precio" type="number" value="0">
</div>
<button onclick="agregar()">Agregar Ítem</button>

<table>
<thead>
<tr>
<th>#</th><th>Código</th><th>Descripción</th><th>Medidas</th>
<th>Cant</th><th>P.Unit</th><th>Subtotal</th><th></th>
</tr>
</thead>
<tbody id="items"></tbody>
</table>

<div class="total-box">
Subtotal: S/ <span id="sub">0.00</span><br>
IGV 18%: S/ <span id="igv">0.00</span><br>
TOTAL: S/ <span id="tot">0.00</span>
</div>

<br>
<button onclick="guardar()">Guardar</button>
<button onclick="vista()">Vista PDF</button>
<button onclick="pdf()">Descargar PDF</button>
<button onclick="imagen()">Exportar Imagen</button>
<button onclick="whatsapp()">WhatsApp</button>
<button onclick="cancelar()" class="danger">Cancelar</button>

<iframe id="preview"></iframe>

</div>

<script>
let lista=[];
let editIndex=null;

function nueva(){
document.getElementById("formulario").style.display="block";
generarNumero();
}

function generarNumero(){
let usados=JSON.parse(localStorage.getItem("cotizaciones"))||[];
let numeros=usados.map(c=>parseInt(c.numero));
let n=1;
while(numeros.includes(n)) n++;
document.getElementById("numero").value=n;
}

function agregar(){
let codigo=document.getElementById("codigo").value;
let desc=document.getElementById("descripcion").value;
let med=document.getElementById("medidas").value;
let cant=parseFloat(document.getElementById("cantidad").value);
let precio=parseFloat(document.getElementById("precio").value);
let subtotal=cant*precio;
lista.push({codigo,desc,med,cant,precio,subtotal});
render();
}

function render(){
let html="";
lista.forEach((i,index)=>{
html+=`<tr>
<td>${index+1}</td>
<td>${i.codigo}</td>
<td>${i.desc}</td>
<td>${i.med}</td>
<td>${i.cant}</td>
<td>${i.precio.toFixed(2)}</td>
<td>${i.subtotal.toFixed(2)}</td>
<td><button onclick="eliminarItem(${index})" class="danger">X</button></td>
</tr>`;
});
document.getElementById("items").innerHTML=html;
calcular();
}

function eliminarItem(i){lista.splice(i,1);render();}

function calcular(){
let sub=lista.reduce((a,b)=>a+b.subtotal,0);
let igv=sub*0.18;
let tot=sub+igv;
document.getElementById("sub").innerText=sub.toFixed(2);
document.getElementById("igv").innerText=igv.toFixed(2);
document.getElementById("tot").innerText=tot.toFixed(2);
}

function guardar(){
let data=JSON.parse(localStorage.getItem("cotizaciones"))||[];
let cot={
numero:document.getElementById("numero").value,
fecha:document.getElementById("fecha").value,
cliente:document.getElementById("cliente").value,
doc:document.getElementById("doc").value,
total:document.getElementById("tot").innerText
};
data.push(cot);
localStorage.setItem("cotizaciones",JSON.stringify(data));
alert("Guardado");
mostrarHistorial();
}

function mostrarHistorial(){
let data=JSON.parse(localStorage.getItem("cotizaciones"))||[];
let buscar=document.getElementById("buscar").value.toLowerCase();
let html="";
data.forEach((c,i)=>{
if(c.cliente.toLowerCase().includes(buscar)||c.doc.includes(buscar)){
html+=`<tr>
<td>${c.numero}</td>
<td>${c.cliente}</td>
<td>${c.doc}</td>
<td>${c.fecha}</td>
<td>${c.total}</td>
<td><button onclick="eliminar(${i})" class="danger">Eliminar</button></td>
</tr>`;
}
});
document.getElementById("historial").innerHTML=html;
}

function eliminar(i){
let data=JSON.parse(localStorage.getItem("cotizaciones"));
data.splice(i,1);
localStorage.setItem("cotizaciones",JSON.stringify(data));
mostrarHistorial();
}

document.getElementById("buscar").addEventListener("input",mostrarHistorial);
mostrarHistorial();
</script>

</body>
</html>
