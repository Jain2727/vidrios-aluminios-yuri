<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cotizaciones - Vidrios y Aluminios Yuri</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 15px;
    background: #f9f9f9;
    color: #003366;
  }
  h1, h2 {
    color: #003366;
  }
  label {
    font-weight: bold;
    display: block;
    margin-top: 10px;
  }
  input, select {
    width: 100%;
    padding: 6px;
    margin-top: 4px;
    box-sizing: border-box;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: white;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #0066cc;
    color: white;
  }
  .btn {
    background-color: #0066cc;
    color: white;
    padding: 10px 18px;
    border: none;
    margin-top: 15px;
    cursor: pointer;
    font-size: 14px;
  }
  .btn:hover {
    background-color: #004c99;
  }
  .footer {
    background-color: #0066cc;
    color: white;
    padding: 10px;
    margin-top: 30px;
    text-align: center;
    font-size: 12px;
  }
  @media(max-width:600px) {
    table, thead, tbody, th, td, tr {
      display: block;
    }
    th {
      position: absolute;
      top: -9999px;
      left: -9999px;
    }
    tr {
      margin-bottom: 15px;
    }
    td {
      border: none;
      position: relative;
      padding-left: 50%;
      text-align: left;
    }
    td:before {
      position: absolute;
      top: 8px;
      left: 10px;
      width: 45%;
      white-space: nowrap;
      font-weight: bold;
      color: #003366;
    }
    td:nth-of-type(1):before { content: "Ítem"; }
    td:nth-of-type(2):before { content: "Código"; }
    td:nth-of-type(3):before { content: "Descripción"; }
    td:nth-of-type(4):before { content: "Cantidad"; }
    td:nth-of-type(5):before { content: "Unidad"; }
    td:nth-of-type(6):before { content: "Precio Unit."; }
    td:nth-of-type(7):before { content: "Subtotal"; }
  }
</style>
</head>
<body>

<h1>Vidrios y Aluminios Yuri</h1>

<section>
  <h2>Datos del Cliente</h2>
  <label for="cliente">Nombre</label>
  <input type="text" id="cliente" placeholder="Nombre completo" required />
  <label for="ruc">RUC / DNI</label>
  <input type="text" id="ruc" placeholder="Documento" required />
  <label for="telefono">Teléfono</label>
  <input type="text" id="telefono" placeholder="Teléfono o celular" />
  <label for="direccion">Dirección</label>
  <input type="text" id="direccion" placeholder="Dirección completa" />
</section>

<section>
  <h2>Agregar Ítem</h2>
  <label for="codigo">Código</label>
  <input type="text" id="codigo" placeholder="Código del producto o servicio" />
  <label for="descripcion">Descripción</label>
  <input type="text" id="descripcion" placeholder="Descripción detallada" required />
  <label for="cantidad">Cantidad</label>
  <input type="number" id="cantidad" min="1" value="1" required />
  <label for="unidad">Unidad</label>
  <select id="unidad">
    <option value="unidad">Unidad</option>
    <option value="m2">Metro cuadrado (m²)</option>
    <option value="ml">Metro lineal (ml)</option>
    <option value="pieza">Pieza</option>
  </select>
  <label for="precio">Precio Unitario (S/)</label>
  <input type="number" id="precio" min="0" step="0.01" value="0" required />
  <button class="btn" onclick="agregarItem()">Agregar Ítem</button>
</section>

<section>
  <h2>Lista de Ítems</h2>
  <table id="tablaItems">
    <thead>
      <tr>
        <th>Ítem</th>
        <th>Código</th>
        <th>Descripción</th>
        <th>Cantidad</th>
        <th>Unidad</th>
        <th>Precio Unit.</th>
        <th>Subtotal</th>
        <th>Eliminar</th>
      </tr>
    </thead>
    <tbody>
      <!-- Aquí van los ítems -->
    </tbody>
  </table>

  <div style="margin-top: 15px; text-align: right; max-width: 400px; margin-left: auto;">
    <p><strong>Subtotal:</strong> S/ <span id="subtotal">0.00</span></p>
    <p><strong>IGV (18%):</strong> S/ <span id="igv">0.00</span></p>
    <p style="font-size:18px"><strong>Total:</strong> S/ <span id="total">0.00</span></p>
  </div>
</section>

<button class="btn" onclick="generarPDF()">Generar PDF</button>

<div class="footer">
  CC.HACCA S/N OMACHA - PARURO - CUSCO | Correo: hermozayurihermozapuelles@gmail.com | Cel: 993 963 381
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
  let items = [];

  function agregarItem() {
    const codigo = document.getElementById('codigo').value.trim();
    const descripcion = document.getElementById('descripcion').value.trim();
    const cantidad = parseFloat(document.getElementById('cantidad').value);
    const unidad = document.getElementById('unidad').value;
    const precio = parseFloat(document.getElementById('precio').value);

    if (!descripcion || cantidad <= 0 || precio < 0) {
      alert('Por favor, completa correctamente la descripción, cantidad y precio.');
      return;
    }

    const subtotal = cantidad * precio;

    items.push({ codigo, descripcion, cantidad, unidad, precio, subtotal });

    actualizarTabla();
    limpiarCampos();
  }

  function eliminarItem(index) {
    items.splice(index, 1);
    actualizarTabla();
  }

  function actualizarTabla() {
    const tbody = document.querySelector('#tablaItems tbody');
    tbody.innerHTML = '';
    items.forEach((item, i) => {
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${item.codigo || '-'}</td>
        <td style="text-align:left;">${item.descripcion}</td>
        <td>${item.cantidad}</td>
        <td>${item.unidad}</td>
        <td>S/ ${item.precio.toFixed(2)}</td>
        <td>S/ ${item.subtotal.toFixed(2)}</td>
        <td><button onclick="eliminarItem(${i})" style="background:#cc0000;color:white;border:none;padding:5px;cursor:pointer;">X</button></td>
      `;

      tbody.appendChild(tr);
    });

    const subtotal = items.reduce((acc, i) => acc + i.subtotal, 0);
    const igv = subtotal * 0.18;
    const total = subtotal + igv;

    document.getElementById('subtotal').innerText = subtotal.toFixed(2);
    document.getElementById('igv').innerText = igv.toFixed(2);
    document.getElementById('total').innerText = total.toFixed(2);
  }

  function limpiarCampos() {
    document.getElementById('codigo').value = '';
    document.getElementById('descripcion').value = '';
    document.getElementById('cantidad').value = 1;
    document.getElementById('unidad').value = 'unidad';
    document.getElementById('precio').value = 0;
  }

  async function generarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const empresaNombre = "VIDRIOS Y ALUMINIOS YURI";
    const ruc = "10617365036";
    const direccionEmpresa = "CC.HACCA S/N OMACHA - PARURO - CUSCO";
    const correo = "hermozayurihermozapuelles@gmail.com";
    const celular = "993 963 381";
    const cuentaBCP = "52671107164027";
    const cci = "00 2526 1711 0716 4027 21";

    const cliente = document.getElementById('cliente').value || '---';
    const rucCliente = document.getElementById('ruc').value || '---';
    const telefonoCliente = document.getElementById('telefono').value || '---';
    const direccionCliente = document.getElementById('direccion').value || '---';

    if (!cliente || !rucCliente) {
      alert('Por favor, ingresa nombre y RUC/DNI del cliente.');
      return;
    }

    if (items.length === 0) {
      alert('Agrega al menos un ítem a la cotización.');
      return;
    }

    const fechaEmision = new Date();
    const fechaValida = new Date(fechaEmision);
    fechaValida.setDate(fechaValida.getDate() + 7);

    // Encabezado
    doc.setFontSize(16);
    doc.setTextColor("#003366");
    doc.setFont("helvetica", "bold");
    doc.text(empresaNombre, 10, 15);

    doc.setFontSize(10);
    doc.setFont("helvetica", "normal");
    doc.text(`RUC: ${ruc}`, 10, 22);
    doc.text(`Dirección: ${direccionEmpresa}`, 10, 28);

    doc.setFontSize(12);
    doc.setFont("helvetica", "bold");
    doc.text("COTIZACIÓN", 150, 15);

    doc.setFontSize(9);
    doc.setFont("helvetica", "normal");
    doc.text(`Fecha emisión: ${fechaEmision.toLocaleDateString('es-PE')}`, 150, 20);
    doc.text(`Válida hasta: ${fechaValida.toLocaleDateString('es-PE')}`, 150, 25);

    doc.setFontSize(11);
    doc.setFont("helvetica", "bold");
    doc.text("DATOS CLIENTE", 10, 40);
    doc.setFont("helvetica", "normal");
    doc.text(`Nombre: ${cliente}`, 10, 46);
    doc.text(`RUC/DNI: ${rucCliente}`, 10, 52);
    doc.text(`Teléfono: ${telefonoCliente}`, 10, 58);
    doc.text(`Dirección: ${direccionCliente}`, 10, 64);

    // Tabla encabezado
    const startY = 75;
    doc.setFillColor(0, 102, 204);
    doc.setTextColor(255, 255, 255);
    doc.rect(10, startY - 7, 190, 8, 'F');

    doc.setFontSize(10);
    doc.text("Ítem", 12, startY);
    doc.text("Código", 30, startY);
    doc.text("Descripción", 55, startY);
    doc.text("Cantidad", 120, startY);
    doc.text("Unidad", 140, startY);
    doc.text("Precio Unit.", 160, startY);
    doc.text("Subtotal", 185, startY);

    doc.setTextColor(0, 0, 0);

    // Datos tabla
    let posY = startY + 5;
    items.forEach((item, index) => {
      doc.text((index + 1).toString(), 12, posY);
      doc.text(item.codigo || '-', 30, posY);
      doc.text(item.descripcion, 55, posY, {maxWidth: 60});
      doc.text(item.cantidad.toString(), 120, posY);
      doc.text(item.unidad, 140, posY);
      doc.text(`S/ ${item.precio.toFixed(2)}`, 160, posY);
      doc.text(`S/ ${item.subtotal.toFixed(2)}`, 185, posY);
      posY += 8;
      if(posY > 270) {
        doc.addPage();
        posY = 20;
      }
    });

    // Totales
    const subtotal = items.reduce((a, b) => a + b.subtotal, 0);
    const igv = subtotal * 0.18;
    const total = subtotal + igv;

    posY += 10;
    doc.setFont("helvetica", "bold");
    doc.text(`COSTO: S/ ${subtotal.toFixed(2)}`, 140, posY);
    posY += 7;
    doc.text(`IGV (18%): S/ ${igv.toFixed(2)}`, 140, posY);
    posY += 7;
    doc.text(`TOTAL COTIZADO: S/ ${total.toFixed(2)}`, 140, posY);

    // Método de pago y firma
    posY += 20;
    doc.setFontSize(10);
    doc.setFont("helvetica", "bold");
    doc.text("METODO DE PAGO", 10, posY);
    posY += 6;
    doc.setFont("helvetica", "normal");
    doc.text(`Cuenta BCP: ${cuentaBCP}`, 10, posY);
    posY += 6;
    doc.text(`CCI: ${cci}`, 10, posY);
    posY += 20;
    doc.text("Fecha y firma:", 10, posY);
    posY += 20;
    // Aquí podrías agregar una imagen de firma si quieres

    // Pie de página con fondo azul
    const pageHeight = doc.internal.pageSize.height;
    doc.setFillColor(0, 102, 204);
    doc.rect(0, pageHeight - 20, 210, 20, 'F');
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(9);
    doc.text(direccionEmpresa, 10, pageHeight - 12);
    doc.text(`Correo: ${correo} | Cel: ${celular}`, 10, pageHeight - 5);

    doc.save(`Cotizacion_${cliente}_${fechaEmision.toISOString().slice(0,10)}.pdf`);
  }
</script>

</body>
</html>
